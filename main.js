(()=>{"use strict";var e={getMethod:"GET",postMethod:"POST",deleteMethod:"DELETE",patchMethod:"PATCH",putMethod:"PUT",baseUrl:"https://nomoreparties.co/v1/wff-cohort-14",headers:{authorization:"33599029-0076-4e00-ad12-21cae39d69c9","Content-Type":"application/json"},handleResponse:function(e){return e.ok?e.json():Promise.reject("Error ".concat(e.status))}},t=function(){return fetch("".concat(e.baseUrl,"/users/me"),{method:e.getMethod,headers:e.headers}).then(e.handleResponse)},r=function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:e.putMethod,headers:e.headers}).then(e.handleResponse)},n=function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:e.deleteMethod,headers:e.headers}).then(e.handleResponse)},o=function(t,o,c){var a=t.link,i=t.name,u=t.likes.length,l=t._id,s=c._id,d=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),p=d.querySelector(".card__image"),f=d.querySelector(".card__like-button"),_=d.querySelector(".card__delete-button");return p.src=a,p.alt=i+" фотокарточка",d.querySelector(".card__title").textContent=i,d.querySelector(".card__like-button-counter").textContent=u,function(t,r,n,o,c){t===r.owner._id?(c.classList.add("card__delete-button_show"),c.addEventListener("click",(function(){!function(t,r){(function(t){return fetch("".concat(e.baseUrl,"/cards/").concat(t),{method:e.deleteMethod,headers:e.headers}).then(e.handleResponse)})(r).then((function(e){e&&t.remove()})).catch((function(e){console.error("Error deleting card:",e)}))}(o,n)}))):c.classList.remove("card__delete-button_show")}(s,t,l,d,_),function(e,t,r){e.likes.some((function(e){return e._id===r._id}))&&t.classList.add("card__like-button_is-active")}(t,f,c),p.addEventListener("click",(function(e){return o(e)})),f.addEventListener("click",(function(e){!function(e,t,o,c,a){var i=e.target,u=t.querySelector(".card__like-button-counter");(c.likes.some((function(e){return e._id===a._id}))?n:r)(o).then((function(e){c.likes=e.likes,i.classList.toggle("card__like-button_is-active"),u.textContent=e.likes.length})).catch((function(e){console.error("Error processing likes : ",e)}))}(e,d,l,t,c)})),d},c=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&t.classList.toggle("popup_is-opened")}},a=function(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",c)},i=function(e){e.classList.contains("popup_is-opened")&&(e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",c))},u=function(e,t){var r=document.querySelector(".".concat(e.id,"-error"));r.classList.remove(t.errorClass),e.classList.remove(t.inputErrorClass),r.textContent="",e.setCustomValidity("")},l=function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var r=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);d(r,n,t),r.forEach((function(e){e.addEventListener("input",(function(){(function(e,t){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?u(e,t):function(e,t,r){var n=document.querySelector(".".concat(e.id,"-error"));n.classList.add(r.errorClass),e.classList.add(r.inputErrorClass),n.textContent=t}(e,e.validationMessage,t)})(e,t),d(r,n,t)}))}))}(t,e)}))},s=function(e,t){var r=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);r.forEach((function(e){u(e,t)})),e.reset(),d(r,n,t)},d=function(e,t,r){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(r.inactiveButtonClass),t.disabled=!1):(t.classList.add(r.inactiveButtonClass),t.disabled=!0)};function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,c,a,i=[],u=!0,l=!1;try{if(c=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=c.call(r)).done)&&(i.push(n.value),i.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return f(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var _=document.querySelector('[name="new-place"]'),h=document.querySelector('[name="edit-avatar"]'),m=document.querySelector('[name="edit-profile"]'),y=document.querySelector(".content"),v=y.querySelector(".places__list"),S=document.querySelector(".popup_type_image"),b=S.querySelector(".popup__image"),q=document.querySelector(".popup__caption"),E=document.querySelector(".popup__input_type_card-name"),g=document.querySelector(".popup__input_type_url"),L=document.querySelector(".popup_type_edit"),k=document.querySelector(".popup_type_new-card"),C=document.querySelectorAll(".popup__close"),A=document.querySelectorAll(".popup"),M=document.querySelector(".profile__image-block"),x=M.querySelector(".profile__image"),w=document.querySelector("#link-avatar"),U=document.querySelector(".popup_type_edit-avatar"),R=document.querySelector(".profile"),j=R.querySelector(".profile__title"),O=y.querySelector(".profile__edit-button"),T=y.querySelector(".profile__add-button"),B=R.querySelector(".profile__description"),P=m.querySelector(".popup__input_type_name"),D=m.querySelector(".popup__input_type_description"),I={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_show"};A.forEach((function(e){e.classList.add("popup_is-animated")}));var N=function(e){var t=e.target.closest(".card"),r=t.querySelector(".card__image"),n=t.querySelector(".card__title");q.textContent=n.textContent,b.src=r.src,b.alt=n.alt,a(S)},J=function(e){e.target.classList.contains("popup_is-opened")&&i(e.target)};Promise.all([t(),fetch("".concat(e.baseUrl,"/cards"),{method:e.getMethod,headers:e.headers}).then(e.handleResponse)]).then((function(e){var t=p(e,2),r=t[0],n=t[1];r._id&&Array.isArray(n)?(H(r,n),z(r),V(r)):console.error("Invalid format")})).catch((function(e){console.error("Error cards data :",e)}));var V=function(e){x.src=e.avatar},z=function(e){j.textContent=e.name,B.textContent=e.about},G=function(e,t){t.textContent=e?"Сохранение...":"Сохранить"},H=function(e,t){e&&e._id?t.forEach((function(t){var r=o(t,N,e);v.append(r)})):console.error("Invalid user data:",e)};l(I),M.addEventListener("click",(function(){a(U),s(h,I)})),h.addEventListener("submit",(function(t){t.preventDefault();var r,n=h.querySelector(".popup__button");G(!0,n),(r=w.value.trim(),fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:e.patchMethod,headers:e.headers,body:JSON.stringify(r)}).then(e.handleResponse)).then((function(e){e&&(x.src=e.avatar,h.reset(),i(U))})).catch((function(e){console.error("Error updating user avatar:",e)})).finally((function(){G(!1,n)}))})),_.addEventListener("submit",(function(r){r.preventDefault();var n=_.querySelector(".popup__button");G(!0,n);var c,a={name:E.value,link:g.value};Promise.all([t(),(c=a,fetch("".concat(e.baseUrl,"/cards"),{method:e.postMethod,headers:e.headers,body:JSON.stringify(c)}).then(e.handleResponse))]).then((function(e){var t=p(e,2),r=t[0],n=t[1];if(r._id&&n){var c=o(n,N,r);v.prepend(c),_.reset(),i(k)}})).catch((function(e){console.error("Error adding new card:",e)})).finally((function(){G(!1,n)}))})),A.forEach((function(e){e.addEventListener("click",J)})),O.addEventListener("click",(function(){s(m,I),P.value=j.textContent,D.value=B.textContent,a(L),l(I)})),T.addEventListener("click",(function(){a(k),s(_,I)})),C.forEach((function(e){e.addEventListener("click",(function(){var t=e.closest(".popup");i(t)}))})),m.addEventListener("submit",(function(t){t.preventDefault();var r,n=m.querySelector(".popup__button"),o=P.value,c=D.value;G(!0,n),(r={name:o,about:c},fetch("".concat(e.baseUrl,"/users/me"),{method:e.patchMethod,headers:e.headers,body:JSON.stringify(r)}).then(e.handleResponse)).then((function(e){e&&(j.textContent=e.name,B.textContent=e.about,i(L))})).catch((function(e){console.error("Error updating profile information:",e)})).finally((function(){G(!1,n)}))}))})();